---
layout: demo
title: Property24 Analytics
summary:
---

<main>
  <section>
    <div class="Component Viewpicker" id="viewpicker"></div>
    <div class="Component Realtime" id="realtime">
      <h1 class="Realtime-content">
        Active Users:
        <span class="Realtime-value" id="active-users"></span>
      </h1>
    </div>
  </section>
</main>

{% include embed-api-snippet.html %}

<!-- This demo uses the viewpicker component, which uses JavaScript promises.
The promise.js script below polyfills promises in older browsers that don't
support them. -->
<script src="assets/js/promise.js"></script>
<script src="components/viewpicker.js"></script>

<!-- This demo uses the datepicker component -->
<script src="components/datepicker.js"></script>

<!-- This demo uses the active-users component -->
<script src="components/active-users.js"></script>

<script>
gapi.analytics.ready(function() {

  /**
   * Authorize this user.
   */
  gapi.analytics.auth.authorize({
    container: 'auth',
    clientid: '{{ site.client_id }}',
  });

  /**
   * Add a callback to add the `is-authorized` class to the body
   * as soon as authorization is successful. This is used to help
   * style components.
   */
  gapi.analytics.auth.on('success', function() {
    document.body.classList.add('is-authorized');
    viewpicker.execute();
  });

  /**
   * Create a new Viewpicker instance to be rendered inside of an
   * element with the id "viewpicker".
   */
  var viewpicker = new gapi.analytics.ext.Viewpicker({
    container: 'viewpicker'
  });

  /**
   * Create a new ActiveUsers instance to be rendered inside of an
   * element with the id "active-users" and poll for changes every
   * five seconds.
   */
  var activeUsers = new gapi.analytics.ext.ActiveUsers({
    container: 'active-users',
    pollingInterval: 30
  });

  /**
   * This code adds/removes HTML classes to trigger CSS animations
   * when the active user counts go up or down.
   */
  var realtime = document.getElementById('realtime');
  realtime.addEventListener('animationend', removeAnimationClasses);
  realtime.addEventListener('webkitAnimationEnd', removeAnimationClasses);
  activeUsers.on('stop', removeAnimationClasses)
  activeUsers.on('change', function(data) {
    realtime.classList.add(data.direction);
  });
  function removeAnimationClasses() {
    realtime.classList.remove('increase');
    realtime.classList.remove('decrease');
  }

  /**
   * Update all of the components if the users changes the view.
   */
  viewpicker.on('change', function(data) {
    activeUsers.set(data).execute();
  });
});

/**
 * Execute a Google Analytics Core Reporting API query
 * and return a promise.
 * @param {Object} params The request parameters.
 * @return {Promise} A promise.
 */
function query(params) {
  return new Promise(function(resolve, reject) {
    var data = new gapi.analytics.report.Data({query: params});
    data.once('success', function(response) { resolve(response); })
        .once('error', function(response) { reject(response); })
        .execute();
  });
}

</script>
</body>
</html>
