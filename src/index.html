---
layout: demo
title: Google Analytics Viewer
summary:
---

<main>
  <div class="container">
    {% for post in site.posts %}
      <div class="row Realtime" id="realtime-{{ forloop.index }}">
        <div class="col-sm-3">
          <div class="Realtime-content">
            <h4>
              {{ post.title }}
            </h4>
            <h1>
              <span class="Realtime-value" id="active-users-{{ forloop.index }}"></span>
            </h1>
          </div>
        </div>
        <div class="col-sm-9">
          <div class="Realtime-chart" id="chart-{{ post.ga-id }}">
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</main>

<script src="assets/js/jquery-1.11.3.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>
{% include embed-api-snippet.html %}
<script type="text/javascript" src="https://www.google.com/jsapi?autoload={'modules':[{'name':'visualization','version':'1.1','packages':['corechart']}]}"></script>
<script src="assets/js/jquery.animateNumber.min.js"></script>
<script src="assets/js/promise.js"></script>
<script src="components/active-users.js"></script>

<script>
gapi.analytics.ready(function() {

  /**
  * Authorize this user.
  */
  gapi.analytics.auth.authorize({
    container: 'auth',
    clientid: '{{ site.client_id }}',
  });

  /**
  * Add a callback to add the `is-authorized` class to the body
  * as soon as authorization is successful. This is used to help
  * style components.
  */
  gapi.analytics.auth.on('success', function() {
    document.body.classList.add('is-authorized');
  });

  {% for post in site.posts %}

  /**
  * Create a new ActiveUsers instance to be rendered inside of an
  * element with the id "active-users" and poll for changes every
  * five seconds.
  */
  var activeUsers{{ forloop.index }} = new gapi.analytics.ext.ActiveUsers({
    container: 'active-users-{{ forloop.index }}',
    pollingInterval: 30,
    ga_id: {{ post.ga-id }},
  });

  /**
  * This code adds/removes HTML classes to trigger CSS animations
  * when the active user counts go up or down.
  */
  var realtime{{ forloop.index }} = document.getElementById('realtime-{{ forloop.index }}');
  realtime{{ forloop.index }}.addEventListener('animationend', removeAnimationClasses);
  realtime{{ forloop.index }}.addEventListener('webkitAnimationEnd', removeAnimationClasses);
  activeUsers{{ forloop.index }}.on('stop', removeAnimationClasses)
  activeUsers{{ forloop.index }}.on('change', function(data) {
    realtime{{ forloop.index }}.classList.add(data.direction);
  });
  activeUsers{{ forloop.index }}.execute();

  {% endfor %}

  function removeAnimationClasses() {
    $('.Realtime').removeClass('increase');
    $('.Realtime').removeClass('decrease');
  }
});

</script>
</body>
</html>
